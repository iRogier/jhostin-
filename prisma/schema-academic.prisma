generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client-academic"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_ACADEMIC")
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
  FAILED
}

model Specialty {
  id          Int      @id @default(autoincrement()) @map("specialty_id")
  name        String   @db.VarChar(255)
  description String?  @db.Text

  teachers    Teacher[]  @relation("SpecialtyTeachers")

  @@map("specialties")
}

model Teacher {
  id             Int            @id @default(autoincrement()) @map("teacher_id")
  firstName      String         @db.VarChar(255) @map("first_name")
  lastName       String         @db.VarChar(255) @map("last_name")
  email          String         @db.VarChar(255) @unique
  phone          String?        @db.VarChar(50) @map("phone")
  specialtyId    Int?           @map("specialty_id")
  employmentType EmploymentType @default(FULL_TIME) @map("employment_type")
  isActive       Boolean        @default(true) @map("is_active")
  
  specialty      Specialty?     @relation("SpecialtyTeachers", fields: [specialtyId], references: [id])
  subjects       Subject[]      @relation("TeacherSubjects")

  @@map("teachers")
}

model Degree {
  id        Int      @id @default(autoincrement()) @map("degree_id")
  name      String   @db.VarChar(255)
  duration  String?  @db.VarChar(100)

  subjects  Subject[]
  students  Student[]

  @@map("degrees")
}

model Cycle {
  id          Int      @id @default(autoincrement()) @map("cycle_id")
  name        String   @db.VarChar(255)
  description String?  @db.Text

  subjects    Subject[]
  students    Student[]

  @@map("cycles")
}

model Subject {
  id             Int          @id @default(autoincrement()) @map("subject_id")
  name           String       @db.VarChar(255)
  description    String?      @db.Text
  teacherId      Int?         @map("teacher_id")
  degreeId       Int?         @map("degree_id")
  cycleId        Int?         @map("cycle_id")
  maxSlots       Int          @default(30) @map("max_slots")
  availableSlots Int          @default(30) @map("available_slots")

  teacher        Teacher?     @relation("TeacherSubjects", fields: [teacherId], references: [id])
  degree         Degree?      @relation(fields: [degreeId], references: [id])
  cycle          Cycle?       @relation(fields: [cycleId], references: [id])
  enrollments    Enrollment[]

  @@map("subjects")
}

model Student {
  id          Int          @id @default(autoincrement()) @map("student_id")
  firstName   String       @db.VarChar(255) @map("first_name")
  lastName    String       @db.VarChar(255) @map("last_name")
  email       String       @db.VarChar(255) @unique
  degreeId    Int?         @map("degree_id")
  cycleId     Int?         @map("cycle_id")
  isActive    Boolean      @default(true) @map("is_active")

  degree      Degree?      @relation(fields: [degreeId], references: [id])
  cycle       Cycle?       @relation(fields: [cycleId], references: [id])
  enrollments Enrollment[]

  @@map("students")
}

model Enrollment {
  id             Int              @id @default(autoincrement()) @map("enrollment_id")
  studentId      Int              @map("student_id")
  subjectId      Int              @map("subject_id")
  academicPeriod String           @db.VarChar(50) @map("academic_period")
  enrollmentDate DateTime         @default(now()) @map("enrollment_date")
  status         EnrollmentStatus @default(ACTIVE)
  
  student        Student          @relation(fields: [studentId], references: [id])
  subject        Subject          @relation(fields: [subjectId], references: [id])

  @@unique([studentId, subjectId, academicPeriod])
  @@map("enrollments")
}
